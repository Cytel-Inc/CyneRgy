<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CyneRgy">
<title>Bayesian Assurance Using East-R • CyneRgy</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Assurance Using East-R">
<meta property="og:description" content="CyneRgy">
<meta property="og:image" content="https://Cytel-Inc.github.io/CyneRgy/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CyneRgy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/ExampleOutline.html">Example List</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Patient Simulation</h6>
    <a class="dropdown-item" href="../articles/2ArmNormalOutcomePatientSimulationDescription.html">2-Arm, Normal Outcome</a>
    <a class="dropdown-item" href="../articles/2ArmTimeToEventOutcomePatientSimulationDescription.html">2-Arm, Time-to-Event Outcome</a>
    <a class="dropdown-item" href="../articles/2ArmBinaryOutcomePatientSimulation.html">2-Arm, Binary Outcome</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/2ArmNormalOutcomeAnalysisDescription.html">2-Arm, Normal Outcome</a>
    <a class="dropdown-item" href="../articles/2ArmTimeToEventOutcomeAnalysisDescription.html">2-Arm, Time-To-Event Outcome</a>
    <a class="dropdown-item" href="../articles/2ArmBinaryOutcomeAnalysisDescription.html">2-Arm, Binary</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Treatment Selection</h6>
    <a class="dropdown-item" href="../articles/TreatmentSelectionDescription.html">Binary Outcome</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Examples</h6>
    <a class="dropdown-item" href="../articles/AssuranceConsecutiveStudies.html">Bayesian Assurance of Consecutive Studies</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Other Integration Points</h6>
    <a class="dropdown-item" href="../articles/GeneratePoissonArrival.html">Poisson Arrival Times</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">References</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/ContibutingToCyneRgy.html">Contribute</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Cytel-Inc/CyneRgy">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bayesian Assurance Using East-R</h1>
                        <h4 data-toc-skip class="author">J. Kyle Wathen
and Laurent Spiess</h4>
            
            <h4 data-toc-skip class="date">May 07, 2024</h4>
      
      
      <div class="d-none name"><code>AssuranceConsecutiveStudies.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The intent of this example is to demonstrate the computation of
Bayesian assurance, or probability of success, through the integration
of R with <a href="Cytel">http://Cytel.com</a> products using a series
of examples. These examples begin with a 2-arm, normal outcome, fixed
sample trial assuming a non-standard prior for computation of assurance.
The examples progress to a more complex setting of computing assurance
for a sequence of a phase 2 trial with normal outcomes followed by a
phase 3 trial where the outcome is time-to-event.</p>
<p>The examples will all contain two treatments, Standard of Care (S)
and Experimental (E) and are follows:</p>
<ol style="list-style-type: decimal">
<li>Fixed sample design using a mixture of normal distributions for
computation of assurance</li>
<li>Expand example 1 to a group sequential design with an interim for
futility based on a Bayesian predictive probability</li>
<li>Fixed design with a time-event-event outcome, this example provides
the basis and a comparison for the phase 2 followed by a phase 3 example
considered last</li>
<li>Two consecutive studies, phase 2 with a normal endpoint followed by
a phase 3 with a normal endpoint</li>
<li>Two consecutive studies, phase 2 with a normal endpoint followed by
a phase 3 with a time-to-event outcome</li>
</ol>
</div>
<div class="section level2">
<h2 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h2>
<div class="section level3">
<h3 id="study-design">Study Design<a class="anchor" aria-label="anchor" href="#study-design"></a>
</h3>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 80 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
</ul>
<p>Denote the minimum acceptable value by MAV. For patients receiving
treatment <span class="math inline">\(j\)</span> = S or E, we assume the
outcomes Y <span class="math inline">\(\sim N( \mu_j, \sigma^2)\)</span>
where, for simplicity, <span class="math inline">\(\mu_j\)</span> is
unknown and <span class="math inline">\(\sigma\)</span> is the known,
fixed quantity. We assume <em>a priori</em> <span class="math inline">\(\mu_j \sim\)</span> Normal( <span class="math inline">\(\theta_j\)</span>, <span class="math inline">\(\tau_j^2\)</span>= <span class="math inline">\(1000^2\)</span> ), for <span class="math inline">\(j=\)</span> S or E. At the end of the study the
following is computed:</p>
<p><span class="math display">\[
    \rho = Pr( \mu_E &gt; \mu_S + MAV | data ) \text{ and}
\]</span> <span class="math display">\[  
    \text{If } \rho &gt; P_U \implies \text{ Go }\\
    \text{ If } \rho \leq P_U \implies \text{ No Go }
\]</span> For decision making we assume <span class="math inline">\(P_U
= 0.8\)</span>. For assurance, a mixture of normal distributions is
assumed. The assurance prior is specified in terms of the prior weight,
mean, and variance for each component of the mixture. For simplicity, we
assume mixture of two normal distributions as follows:</p>
<ul>
<li>Weight: 25% on <span class="math inline">\(N( 0, 0.05
)\)</span>
</li>
<li>Weight: 75% on <span class="math inline">\(N( 0.7,
0.3^2)\)</span>
</li>
</ul>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="r-integration">R Integration<a class="anchor" aria-label="anchor" href="#r-integration"></a>
</h3>
<p>In order to evaluate the design above, one can develop an R function
for analysis that can be called from East during simulation. By
replacing only the analysis function with an R function, one can obtain
the frequentist operating characteristics of the Bayesian design using
East. In addition, by replacing how the patient data is simulated one
can obtain the Bayesian assurance. Specifically, in the simulation when
the patient data is simulated an R function will first sample the
assurance prior then sample the patient data. The resulting power of
this simulation will be the Bayesian assurance assuming the 2 component
prior given above.</p>
<p>There is often a need for examination of posterior distribution of
both observed and true treatment differences given a Go decision. These
posterior distributions can be useful for planning the next phase of
study and understanding potential risks. Obtaining the posterior
distributions is described in the next section and they are applied to
the phase 2 followed by phase 3 in later sections.</p>
<div class="section level4">
<h4 id="required-r-functions">Required R Functions<a class="anchor" aria-label="anchor" href="#required-r-functions"></a>
</h4>
<p>The two functions that are needed to evaluate this design and obtain
the Bayesian assurance are the analysis function,
AnayzeUsingBayesianNormals, and patient simulation function,
SimulatePatientOutcomeNormalAssurance.</p>
<p>To help understand the AnayzeUsingBayesianNormals one must first
derive the posterior distributions.</p>
<p>After observing <span class="math inline">\(n\)</span> patients on
treatment <span class="math inline">\(j =\)</span> S or E, the posterior
distribution of <span class="math inline">\(\mu_j\)</span> is:</p>
<p><span class="math display">\[
\mu_j | \bar{y} \sim N( \theta_j^*, \tau_j^{2*} )
\]</span> where <span class="math display">\[
\theta_j^* = \frac{\frac{\theta_j}{\tau_j^2} +
\frac{n}{\sigma^2}\bar{y}}{\frac{1}{\tau_j^2}+ \frac{1}{\sigma^2}}
\text{ and }
\frac{1}{\tau_j^{2*}} = \frac{1}{\tau_j^2} +\frac{n}{\sigma^2}
\]</span></p>
</div>
<div class="section level4">
<h4 id="integration-with-east">Integration with East<a class="anchor" aria-label="anchor" href="#integration-with-east"></a>
</h4>
<p>Using the East workbook named Assurance.cywx with East version <span class="math inline">\(&gt;=\)</span> 6.5.4 the Example 1 simulation can
be used to obtain the results found in the next section. After editing
the simulation, on the User Define R Functions the Generate Response and
Compute Test Statistic are both replaced with R code. The Generate
Response utilizes the SimulatePatientOutcomeNormalAssurance found in the
file named <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/SimulatePatientOutcomeNormalAssurance.R" class="external-link">R/SimulatePatientOutcomeNormalAssurance.R</a>
and has variables as shown below. For the Compute Test Statistic the
function name AnalyzeUsingBayesianNormals found in <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/AnalyzeUsingBayesianNormals.R" class="external-link">RCode/AnalyzeUsingBayesianNormals.R</a>
with input shown below.</p>
<div class="float">
<img src="Example1GenerateResponseInput.jpg" alt="Input for generate response in East"><div class="figcaption">Input for generate response in East</div>
</div>
<div class="float">
<img src="Example1TestStatisticInput.jpg" alt="Input for test statistitic input in East"><div class="figcaption">Input for test statistitic input in East</div>
</div>
</div>
<div class="section level4">
<h4 id="integration-with-solara">Integration with Solara<a class="anchor" aria-label="anchor" href="#integration-with-solara"></a>
</h4>
<p>The setup in Solara is very similar to East. Solara utilizes the same
R functions. In the Responses tab, the Generate Response utilizes the
SimulatePatientOutcomeNormalAssurance found in the file named <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/SimulatePatientOutcomeNormalAssurance.R" class="external-link">R/SimulatePatientOutcomeNormalAssurance.R</a>
and has variables as shown below. For the Compute Test Statistic the
function name AnalyzeUsingBayesianNormals found in <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/AnalyzeUsingBayesianNormals.R" class="external-link">RCode/AnalyzeUsingBayesianNormals.R</a>
with input shown below.</p>
<div class="float">
<img src="Example1GenerateResponseSolara.jpg" alt="Input for generate response in Solara"><div class="figcaption">Input for generate response in Solara</div>
</div>
<div class="float">
<img src="Example1TestStatisticSolara.jpg" alt="Input for test statistic in Solara"><div class="figcaption">Input for test statistic in Solara</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>The probability of a Go is 15.3% and the probability of a No Go is
84.7%.</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h2>
<div class="section level3">
<h3 id="study-design-1">Study Design<a class="anchor" aria-label="anchor" href="#study-design-1"></a>
</h3>
<p>Same study design as previous example, however, this design includes
an interim analysis to check for futility when 50% of the patients have
their outcome observed. The futility rule is based on a Bayesian
predictive probability of a No Go at the end of the study. That is, at
the interim analysis if it is likely that the study will make a No Go
decision at the final analysis, then the study is stopped early for
futility.</p>
<p>Denote the data at the interim analysis by <span class="math inline">\(X_1\)</span> and data for patients enrolled after
the IA by <span class="math inline">\(X_2\)</span>. If the predictive
probability of a No Go at the final analysis is greater than <span class="math inline">\(PU_{Futility} = 90\)</span>% then the trial is
stopped for futility. Specifically, if</p>
<p><span class="math display">\[
    Pr( \text{End of Study No Go} | X_1 ) &gt; PU_{Futility} = 90\%
\]</span> then the trial is stopped for futility. The prediction formula
becomes <span class="math display">\[
Pr( \text{End of Study No Go} | X_1 ) = Pr[ \{ Pr( \mu_E &gt; \mu_S +
MAV | X_1, X_2 ) &gt; PU \} | X_1  ] &gt; PU_{Futility}
\]</span></p>
</div>
<div class="section level3">
<h3 id="r-integration-1">R Integration<a class="anchor" aria-label="anchor" href="#r-integration-1"></a>
</h3>
<p>In order to evaluate the design above, one can develop an R function
for analysis that can be called from East during simulation. By
replacing only the analysis function with an R function, one can obtain
the frequentist operating characteristics of the Bayesian design using
East that includes the interim analysis and futility check based on a
Bayesian predictive probability. In addition, by replacing how the
patient data is simulated one can obtain the Bayesian assurance.
Specifically, in the simulation when the patient data is simulated an R
function will first sample the assurance prior then sample the patient
data. The resulting power of this simulation will be the Bayesian
assurance assuming the 2 component prior given in Example 1 and
including the futility check.</p>
<div class="section level4">
<h4 id="required-r-functions-1">Required R Functions<a class="anchor" aria-label="anchor" href="#required-r-functions-1"></a>
</h4>
<p>Same as example 1, just need to provide the <span class="math inline">\(PU_{Futility}\)</span> parameter. The same R code
function is used for Example 1 and 2. The only difference between this
example and Example 1 is the addition of the dPUFutility and the interim
analysis.</p>
<div class="float">
<img src="Example2TestStatisticInput.jpg" alt="Input for test statistitic input"><div class="figcaption">Input for test statistitic input</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="results-1">Results<a class="anchor" aria-label="anchor" href="#results-1"></a>
</h3>
<p>The results of the design are as follows:</p>
<ul>
<li>The probability of an end of study Go is: 0.1478</li>
<li>The probability of an end of study No Go (Stop) is: 0.2656</li>
<li>The probability of futility at the interim: 0.5866</li>
<li>The probability of a Go conditional on not stopping at the interim:
0.357523</li>
<li>The probability of a No Go conditional on not stopping at the
interim: 0.642477</li>
</ul>
<p>The posterior mean of the true delta, <span class="math inline">\(\mu_E-\mu_S\)</span>, given a Go decision is:
0.992</p>
<p>The summary of the true delta given a Go decision is:</p>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##   0.023   0.823   0.990   0.992   1.151   2.009</span></span></code></pre>
<p>The scaled posterior distribution of the true delta given a Go
decision is:</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-3">Example 3<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h2>
<div class="section level3">
<h3 id="study-design-2">Study Design<a class="anchor" aria-label="anchor" href="#study-design-2"></a>
</h3>
<p>This study is a two-arm fixed sample size design with a time-to-event
endpoint. Total sample size is 600 patients with 300 patients per arm.
There is a single analysis when 50% of the patients have had their event
observed. A hazard ratio (HR) below 1 is considered to favor the
experimental arm. The analysis is assumed to be a cox proportional
hazard model where a Go decision is made if the p-value <span class="math inline">\(\leq\)</span> 0.025.</p>
<p>For assurance, a bi-modal prior on the Log(HR) is used. The
components of the prior are:</p>
<ul>
<li>Weight: 25% on <span class="math inline">\(N( 0, 0.02
)\)</span>
</li>
<li>Weight: 75% on <span class="math inline">\(Beta( 2, 2)\)</span>,
rescaled between -0.4 and 0.</li>
</ul>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="r-integration-2">R Integration<a class="anchor" aria-label="anchor" href="#r-integration-2"></a>
</h3>
<div class="section level4">
<h4 id="required-r-functions-2">Required R Functions<a class="anchor" aria-label="anchor" href="#required-r-functions-2"></a>
</h4>
<p>This are 3 required R files and functions needed to evaluate this
design. The first file is used to initialize the R environment and load
the survival package. The second file is used to perform the analysis
using a Cox model. The third required file is used to first simulate the
true HR from the prior and then simulate the patient data using the
sampled HR.</p>
<p>The initialize function InitializeSurvival is found in the file <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/InitializeSurvival.R" class="external-link">R/SimulatePatientOutcomeNormalAssurance.R</a>.
The function used for analysis is AnalyzeSurivalDataUsingCoxPH, is found
in the file <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/AnalyzeSurvivalDataUsingCoxPH.R" class="external-link">R/AnalyzeSurvivalDataUsingCoxPH.R</a>
The function used for simulating patient data is
SimulatePatientOutcomeNormalAssurance and is found in the file <a href="https://github.com/Cytel-Inc/CyneRgy/blob/Dev/inst/Examples/AssuranceConsecutiveStudies/RCode/SimulatePatientOutcomeNormalAssurance.R" class="external-link">RCode/SimulatePatientOutcomeNormalAssurance.R</a></p>
</div>
<div class="section level4">
<h4 id="integration-with-east-1">Integration with East<a class="anchor" aria-label="anchor" href="#integration-with-east-1"></a>
</h4>
<p>The required user input for generating patient survival in East is
provided below.</p>
<div class="float">
<img src="Example3GenerateResponseInput.jpg" alt="Input for generate response"><div class="figcaption">Input for generate response</div>
</div>
</div>
<div class="section level4">
<h4 id="integration-with-solara-1">Integration with Solara<a class="anchor" aria-label="anchor" href="#integration-with-solara-1"></a>
</h4>
<p>The required user input for generating patient survival in Solara is
provided below.</p>
<div class="float">
<img src="Example3GenerateResponseSolara.jpg" alt="Input for generate response"><div class="figcaption">Input for generate response</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="results-2">Results<a class="anchor" aria-label="anchor" href="#results-2"></a>
</h3>
<p>The probability of a Go decision is 33% and the probability of a No
Go Decision is is 67%. The posterior distribution of the true Log( HR )
given a Go decision is:</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="example-4---two-consecutive-studies-and-de-risking">Example 4 - Two Consecutive Studies and De-risking<a class="anchor" aria-label="anchor" href="#example-4---two-consecutive-studies-and-de-risking"></a>
</h2>
<p>In this section we explore computing assurance and conditional
assurance for two consecutive studies. A phase 2 with normal endpoints
(similar setup to Example 1) followed by a Phase 3 with a normal
endpoint.</p>
<p>The goal is to understand how much the phase 3 trial can be de-risked
by first running a phase 2 study to gather additional information.
De-risking is determined by comparing the probability of a No Go in a
phase 3 if the phase 2 was skipped versus the probability of a No Go in
phase 3 if the phase 2 was first conducted and successful. Specifically,
we compute the assurance of the phase 3 conditional on a Go decision in
phase 2.</p>
<div class="section level3">
<h3 id="study-design---phase-2">Study Design - Phase 2<a class="anchor" aria-label="anchor" href="#study-design---phase-2"></a>
</h3>
<p>Same priors as Example 1.</p>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 80 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
<li>MAV = 0.6</li>
<li><span class="math inline">\(P_U = 0.8\)</span></li>
</ul>
<div class="section level4">
<h4 id="results-for-phase-2">Results For Phase 2<a class="anchor" aria-label="anchor" href="#results-for-phase-2"></a>
</h4>
<p>The probability of a Go is 26.7% and the probability of a No Go is
73.3%.</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="study-design---phase-3">Study Design - Phase 3<a class="anchor" aria-label="anchor" href="#study-design---phase-3"></a>
</h3>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 200 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
<li>MAV = 0.6</li>
<li><span class="math inline">\(P_U = 0.5\)</span></li>
</ul>
<p>With MAV = 0.6 and <span class="math inline">\(P_U = 0.5\)</span>
this design is equivalent to using a t-test because the critical value
would be 0.6 and having a posterior probability greater than 0.5 would
indicate that the estimated treatment difference is above the critical
value.</p>
<div class="section level4">
<h4 id="results-for-phase-3">Results For Phase 3<a class="anchor" aria-label="anchor" href="#results-for-phase-3"></a>
</h4>
<p>The probability of a Go in Phase 3 is 46% and the probability of a No
Go is 54%.</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="phase-2-followed-by-phase-3">Phase 2 followed by Phase 3<a class="anchor" aria-label="anchor" href="#phase-2-followed-by-phase-3"></a>
</h3>
<p>Using a Phase 2 design like above.</p>
<p><em>Phase 2</em></p>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 80 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
<li>MAV = 0.6</li>
<li><span class="math inline">\(P_U = 0.8\)</span></li>
</ul>
<p>If the Phase 2 makes a Go decision then the Phase 3 is conducted as
follows:</p>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 200 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
<li>MAV = 0.6</li>
<li><span class="math inline">\(P_U = 0.5\)</span></li>
</ul>
<div class="section level4">
<h4 id="results-for-phase-2-followed-by-phase-3">Results For Phase 2 Followed by Phase 3<a class="anchor" aria-label="anchor" href="#results-for-phase-2-followed-by-phase-3"></a>
</h4>
<p>Given a Go decision is made in Phase 2, the probability of a Go in
Phase 3 is 84.8% and the probability of a No Go is 15.2%.</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="de-risking">De-risking<a class="anchor" aria-label="anchor" href="#de-risking"></a>
</h4>
<p>Comparing the option of running only a Phase 3 versus a Phase 2
followed by a Phase 3 if Phase 2 is successful, the probability of Go in
phase 3 increases from 46% to 84.8% and the probability of a No Go in
Phase 3 decreases from 54% to 15.2%.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-5---two-consecutive-studies-and-de-risking">Example 5 - Two Consecutive Studies and De-risking<a class="anchor" aria-label="anchor" href="#example-5---two-consecutive-studies-and-de-risking"></a>
</h2>
<p>In this section we explore computing assurance and conditional
assurance for two consecutive studies. A phase 2 with normal endpoints
(similar setup to Example 1) followed by a Phase 3 with a time-to-event
endpoint.</p>
<div class="section level3">
<h3 id="study-design-phase-2">Study Design Phase 2<a class="anchor" aria-label="anchor" href="#study-design-phase-2"></a>
</h3>
<p>Same priors as Example 1.</p>
<p>Fixed sample, with normally distributed outcomes Y.</p>
<ul>
<li>Sample size: 80 patients per arm</li>
<li>Assume standard deviation is known: <span class="math inline">\(\sigma = 1.9\)</span>
</li>
<li>MAV = 0.6</li>
<li><span class="math inline">\(P_U = 0.8\)</span></li>
</ul>
<div class="section level4">
<h4 id="results-for-phase-2-1">Results For Phase 2<a class="anchor" aria-label="anchor" href="#results-for-phase-2-1"></a>
</h4>
<p>The probability of a Go is 26.7% and the probability of a No Go is
73.3%.</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="study-design-phase-3">Study Design Phase 3<a class="anchor" aria-label="anchor" href="#study-design-phase-3"></a>
</h3>
<p>This study is a two-arm fixed sample size design with a time-to-event
endpoint. Total sample size is 600 patients with 300 patients per arm.
There is a single analysis when 50% of the patients have had their event
observed. A hazard ratio (HR) below 1 is considered to favor the
experimental arm. The analysis is assumed to be a cox proportional
hazard model where a Go decision is made if the p-value <span class="math inline">\(\leq\)</span> 0.025.</p>
<p>The relationship between the continuous endpoint in phase 2 and the
time-to-event endpoint in phase 3 is assumed to follow a linear
function:</p>
<p><span class="math display">\[
log(\ True \ HR\ ) \text{ in phase 3 = 0.1 − 0.4 ∗ ( true treatment
difference in phase  2)}
\]</span></p>
<p>Note that the relationship is established on the true treatment
effects. Since the phase 2 provides a prior on the true treatment
different and we have the linear link function between the true
treatment difference and the true HR, we do not need to specify the
prior on the true HR like in Example 3.</p>
</div>
<div class="section level3">
<h3 id="east-r-integration">East-R Integration<a class="anchor" aria-label="anchor" href="#east-r-integration"></a>
</h3>
<p>For this example, in the East workbook Example 5 - Phase 2 is used to
simulate the phase 2 and Example 5 - Phase 3 is used to simulate the
phase 3 for both the conditional and unconditional assurance
calculations. When the phase 2 is simulated, the true treatment
different is sampled from the prior is saved in the output file from
phase 2. Both the conditional and unconditional phase 3 use an R
initialize function to read in the output from the phase 2 and obtain
the true treatment difference which is then converted to the log of the
true HR given the link function above. Note, for the unconditional
assurance an alternative approach would be to sample the phase 2 prior
directly rather then read the output from phase 2. However, reading the
true values in from the phase 2 creates a more consistent comparison
between the conditional and unconditional assurance calculations and a
more accurate estimate of the benefit of running the phase 2 prior to
the phase 3.</p>
<div class="section level4">
<h4 id="required-r-function">Required R Function<a class="anchor" aria-label="anchor" href="#required-r-function"></a>
</h4>
<p>For the phase 2, the same functions are needed as Example 2.</p>
<p>The two functions that are needed to evaluate this design and obtain
the Bayesian assurance are the analysis function,
AnayzeUsingBayesianNormals, and patient simulation function,
SimulatePatientOutcomeNormalAssurance.</p>
<p>For the phase 3, three functions are needed: 1)
ReadExample5Phase2Output, 2) AnalyzeSurvivalDataUsingCoxPh, and 3)
SimulatePatientSurvivalAssuranceUsingPh2Pior and the functions are
located in the R directory in the file with the matching file name. The
ReadExample5Phase2Output is called from the Initialize R Environment in
East and loads the survival package as it is needed for the coxph
function and also reads in the true treatment difference from phase 2.
Note the use of the &lt;&lt;- operator to create a global variables
vPrior, the vector with the treatment difference, and nSimIndex to keep
track of which simulation index or replication the simulation is
executing when the call to SimulatePatientSurvivalAssuranceUsingPh2Pior
is executed. Both vPrior and nSimIndex are utilized in the function
SimulatePatientSurvivalAssuranceUsingPh2Pior and the nSimIndex variable
is updated with each call.</p>
<p>The function ReadExample5Phase2Output utilizes the UserParam
variables from East and if UserParam$bConditionalOnGo is 1, then only
the true treatment effects that resulted in a Go decision in Phase 2 are
retained allowing the simulation to compute the conditional assurance.
Note that the number of replications used in simulating the phase 3 for
conditional assurance must be less than or equal to the number of
simulated phase 2 trials that were successful. If
UserParam$bConditionalOnGo is 0 then all true treatment effects sampled
in the Phase 2 are retained allowing the simulation to compute the
unconditional assurance.</p>
</div>
</div>
<div class="section level3">
<h3 id="results-phase-3-no-phase-2-conducted">Results Phase 3, No Phase 2 Conducted<a class="anchor" aria-label="anchor" href="#results-phase-3-no-phase-2-conducted"></a>
</h3>
<p>For Phase 3, the unconditional probability of a Go decision is 29%
and the unconditional probability of a No Go Decision is 71%. The 95%
posterior credible for the Log( True HR ) is (-<span class="math inline">\(\infty\)</span>, 0.12 ). The posterior
distribution of the true Log( HR ) given a Go decision is:</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="results-phase-3-conditional-on-phase-2-go-decision">Results Phase 3, Conditional on Phase 2 Go Decision<a class="anchor" aria-label="anchor" href="#results-phase-3-conditional-on-phase-2-go-decision"></a>
</h3>
<p>For Phase 3, conditional on the phase 2 making a go decision, the
probability of a Go decision is 60% and the unconditional probability of
a No Go Decision is 40%. The 95% posterior credible for the Log( True HR
) is (-0.46, -0.08). The posterior distribution of the true Log( HR )
given a Phase 3 Go decision is:</p>
<p><img src="AssuranceConsecutiveStudies_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<div class="section level4">
<h4 id="de-risking-1">De-risking<a class="anchor" aria-label="anchor" href="#de-risking-1"></a>
</h4>
<p>Comparing the option of running only a Phase 3 versus a Phase 2
followed by a Phase 3 if Phase 2 is successful, the probability of Go in
phase 3 increases from 29% to 60% and the probability of a No Go in
Phase 3 decreases from 71% to 40%.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by J. Kyle Wathen, Valeria A. G. Mazzanti, Sydney Ringold.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
