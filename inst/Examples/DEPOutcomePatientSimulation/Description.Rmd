---
title: "Dual Endpoints - Patient Simulation"
author: "Gabriel Potvin, Anoop Singh Rawat, Pradip Maske"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document: default
  word_document: default
---

<div class="alert alert-primary" role="alert">
<p style="margin-bottom:0">This example is related to the <a href="IntegrationPointResponseDual.html" class="alert-link">**Integration Point: Response - Dual Endpoints**</a>. Click the link for setup instructions, variable details, and additional information about this integration point.</p></div>

<div class="alert alert-danger" role="alert">
To try this example, create a new project in East Horizon using the following configuration:
<ul style="margin-bottom:0">
<li>**Study objective:** Two Arm Confirmatory</li>
<li>**Number of endpoints:** Dual Endpoints</li>
<li>**Endpoint type:** *Time-to-Event - Time-to-Event*</li>
<li>**Task:** Explore</li>
</ul></div>

# Introduction

The following examples illustrate how to integrate new patient outcome simulation (*response*) capabilities into East Horizon using R functions in the context of 2-arm clinical trials with dual endpoints. The first example shows how to simulate correlated dual time-to-event (TTE) endpoints.

In the [directory of this example](https://github.com/Cytel-Inc/CyneRgy/tree/main/inst/Examples/DEPOutcomePatientSimulation) you will find the following R file:

1. [SimulatePatientOutcomeSurvSurvSingleHazardPiece.R](https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/DEPOutcomePatientSimulation/SimulatePatientOutcomeSurvSurvSingleHazardPiece.R) - Contains the implementation for simulating correlated TTE outcomes under a single-piece hazard assumption for both endpoints.

# Example 1 - Simulate Correlated TTE-TTE Dual Endpoints

<div class="alert alert-primary" role="alert">
  <p style="margin-bottom:0"> This example is related to this R file: <a href="https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/DEPOutcomePatientSimulation/SimulatePatientOutcomeSurvSurvSingleHazardPiece.R" class="alert-link">SimulatePatientOutcomeSurvSurvSingleHazardPiece.R</a></p>
</div>

The function *SimulatePatientOutcomeSurvSurv.DEP* simulates patient-level outcomes for a dual-endpoint design where both endpoints are time-to-event variables. Each endpoint is modeled using an exponential survival distribution, with arm-specific hazard rates supplied through the East Horizon interface.

To simulate correlated endpoints, the function first maps the qualitative correlation level (e.g., *Weak Positive*, *Strong Negative*) to a numerical correlation coefficient and constructs the corresponding 2Ã—2 correlation matrix. A Cholesky decomposition of this matrix is then used to generate pairs of correlated standard normal variables for each simulated subject. These correlated normal deviates are transformed into uniform and subsequently exponential variates using the specified hazard rates for each arm, producing one survival time per endpoint per subject.

This process results in two correlated vectors of event times (one for each endpoint) returned within a structured response list compatible with East Horizon. This simulation framework is useful for evaluating trial designs that incorporate dual TTE endpoints, such as joint success criteria or composite decision rules based on both survival outcomes.

The figure below illustrates where this example fits within the R integration points of Cytel products, accompanied by a flowchart outlining the general steps performed by the R code.

```{r echo=FALSE,  warning=FALSE, fig.retina=3}
CyneRgy::PlotExampleFlowchart(
    lIntPoints = list(
        "Response" = c(
            "Load design and endpoint parameters",
            "Generate correlated normal variates",
            "Transform to survival times using hazard rates",
            "Assemble endpoint responses for each subject",
            "Return Response list"
        )
    )
)
```
