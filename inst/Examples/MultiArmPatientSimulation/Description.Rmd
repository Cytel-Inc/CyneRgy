---
title: "Multiple Arm, Patient Simulation"
author: "Gabriel Potvin and Anoop Singh Rawat"
date: "`r format(Sys.time(), '%B %d, %Y')`"
---

<div class="alert alert-primary" role="alert">
<p style="margin-bottom:0">This example is related to the <a href="IntegrationPointResponse.html" class="alert-link">**Integration Point: Response**</a>. Click the link for setup instructions, variable details, and additional information about this integration point.</p></div>

<div class="alert alert-danger" role="alert">
To try this example, create a new project in East Horizon using the following configuration:
<ul style="margin-bottom:0">
<li>**Study objective:** Multiple Arm Confirmatory, 3 Arms</li>
<li>**Number of endpoints:** Single Endpoint</li>
<li>**Endpoint type:**</li>
<ul style="margin-bottom:0">
<li>Continuous Outcome for Example 1</li>
<li>Time-to-Event Outcome for Example 2</li>
<li>Binary Outcome for Example 3</li>
</ul>
<li>**Task:** Any</li>
</ul></div>

# Introduction

The following examples illustrate how to integrate new patient outcome simulation (*response*) capabilities into East Horizon using R functions in the context of a multi-arm clinical trials. Each example demonstrates a different type of statistical endpoint (continuous, time-to-event, and binary).

In the [R directory of this example](https://github.com/Cytel-Inc/CyneRgy/tree/main/inst/Examples/MultiArmPatientSimulation/R) you will find the following R files:

1. [SimulatePatientOutcomeMultiArmPercentAtZero.R](https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientOutcomeMultiArmPercentAtZero.R) - Simulates continuous outcomes from a mixture distribution where a proportion of patients have no response.

2. [SimulatePatientSurvivalMultiArmWeibull.R](https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientSurvivalMultiArmWeibull.R) - Simulates time-to-event outcomes using a Weibull distribution, allowing arm-specific shape and scale parameters.

3. [SimulatePatientOutcomeMultiArmPercentAtZero.Binary.R](https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientOutcomeMultiArmPercentAtZero.Binary.R) - Simulates binary outcomes from a mixture distribution where a proportion of patients have no response.

# Example 1 - Simulation of Continuous Outcomes with Non-Responders

<div class="alert alert-primary" role="alert">
  <p style="margin-bottom:0"> This example is related to this R file: <a href="https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientOutcomeMultiArmPercentAtZero.R" class="alert-link">SimulatePatientOutcomeMultiArmPercentAtZero.R</a></p>
</div>

In this example, each patient's outcome represents a change from baseline. However, some patients are expected to show no improvement (non-responders), leading to an outcome of zero. The proportion of such patients can vary across treatment arms (e.g., between 20% and 40% based on prior data).

The function *SimulatePatientOutcomeMultiArmPercentAtZero* extends the two-arm approach to three arms (two treatment arms), simulating each patientâ€™s outcome according to their assigned treatment. For each arm, the function uses the probability of a zero outcome to determine whether a patient is a non-responder; responders then have their outcome simulated from a normal distribution with arm-specific mean and standard deviation.

**Note**: This example could be extended to any number of treatment arms by adding more user parameters such as `dProbOfZeroOutcomeExp3`, `dProbOfZeroOutcomeExp4`, etc.

Refer to the table below for the definitions of the user-defined parameters used in this example.

|**User parameter**|**Definition**|
|---|------|
|**dProbOfZeroOutcomeCtrl**|Value between 0 and 1 representing the probability a patient is a non-responder in the control arm.|
|**dProbOfZeroOutcomeExp1**|Value between 0 and 1 representing the probability a patient is a non-responder in the first experimental arm.|
|**dProbOfZeroOutcomeExp2**|Value between 0 and 1 representing the probability a patient is a non-responder in the second experimental arm.|

The figure below illustrates where this example fits within the R integration points of Cytel products, accompanied by a flowchart outlining the general steps performed by the R code.

```{r echo=FALSE,  warning=FALSE, fig.retina=3}
CyneRgy::PlotExampleFlowchart(
    lIntPoints = list(
        "Response" = c(
            "Load arm-specific non-response probabilities",
            "Loop through patients",
            "Simulate if outcome is 0 (non-responder)",
            "If not 0, simulate outcome from Normal( mean, sd )",
            "Return response vector"
        )
    )
)
```

# Example 2 - Simulation of Time-to-Event Outcomes from a Weibull Distribution

<div class="alert alert-primary" role="alert">
  <p style="margin-bottom:0"> This example is related to this R file: <a href="https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientSurvivalMultiArmWeibull.R" class="alert-link">SimulatePatientSurvivalMultiArmWeibull.R</a></p>
</div>

This example demonstrates how to simulate time-to-event data for multiple treatment arms using arm-specific Weibull parameters. Each arm is characterized by its own shape and scale values, allowing flexible modeling of distinct hazard profiles across arms.

The R function *SimulatePatientSurvivalMultiArmWeibull* extends the two-arm approach to three arms (two treatment arms), generating a survival time for each patient according to the Weibull distribution corresponding to their assigned arm. This enables users to evaluate study power or expected treatment differences under non-proportional hazards or complex multi-arm designs.

**Note**: This example could be extended to any number of treatment arms by adding more user parameters such as `dShapeExp3` and `dScaleExp3`, `dShapeExp4` and `dScaleExp4`, etc.

Refer to the table below for the definitions of the user-defined parameters used in this example.

|**User parameter**|**Definition**|
|---|---------|
|**dShapeCtrl**|Shape parameter of the Weibull distribution for the control arm.|
|**dShapeExp1**|Shape parameter of the Weibull distribution for the first experimental arm.|
|**dShapeExp2**|Shape parameter of the Weibull distribution for the second experimental arm.|
|**dScaleCtrl**|Scale parameter of the Weibull distribution for the control arm.|
|**dScaleExp1**|Scale parameter of the Weibull distribution for the first experimental arm.|
|**dScaleExp2**|Scale parameter of the Weibull distribution for the second experimental arm.|

The figure below illustrates where this example fits within the R integration points of Cytel products, accompanied by a flowchart outlining the general steps performed by the R code.

```{r echo=FALSE,  warning=FALSE, fig.retina=3}
CyneRgy::PlotExampleFlowchart(
    lIntPoints = list(
        "Response" = c(
            "Load Weibull shape and scale per arm",
            "Loop through patients",
            "Simulate survival time using rweibull( shape, scale )",
            "Return survival time vector"
        )
    )
)
```

# Example 3 - Simulation of Binary Outcomes with Treatment Resistance

<div class="alert alert-primary" role="alert">
  <p style="margin-bottom:0"> This example is related to this R file: <a href="https://github.com/Cytel-Inc/CyneRgy/blob/main/inst/Examples/MultiArmPatientSimulation/R/SimulatePatientOutcomeMultiArmPercentAtZero.Binary.R" class="alert-link">SimulatePatientOutcomeMultiArmPercentAtZero.Binary.R</a></p>
</div>

In this example, patient outcomes are binary, where `0` represents treatment failure (non-response), and `1` indicates a successful treatment and response. Some patients, however, are treatment-resistant, meaning they will not respond to any treatment and thus always yield an outcome of `0`. The proportion of resistant patients can differ between treatment arms.

The R function *SimulatePatientOutcomeMultiArmPercentAtZero.Binary* extends the two-arm approach to three arms (two treatment arms), where each arm has its own probability of treatment resistance. For each simulated patient, the function first determines whether they are treatment-resistant and, if not, simulates their binary response using the arm-specific probability of success.

**Note**: This example could be extended to any number of treatment arms by adding more user parameters such as `dProbOfTreatmentResistantExp3`, `dProbOfTreatmentResistantExp4`, etc.

Refer to the table below for the definitions of the user-defined parameters used in this example.

|**User parameter**|**Definition**|
|----|------|
|**dProbOfTreatmentResistantCtrl**|Value between 0 and 1 representing the probability a patient is treatment-resistant in the control arm.|
|**dProbOfTreatmentResistantExp1**|Value between 0 and 1 representing the probability a patient is treatment-resistant in the first experimental arm.|
|**dProbOfTreatmentResistantExp2**|Value between 0 and 1 representing the probability a patient is treatment-resistant in the second experimental arm.|

The figure below illustrates where this example fits within the R integration points of Cytel products, accompanied by a flowchart outlining the general steps performed by the R code.

```{r echo=FALSE,  warning=FALSE, fig.retina=3}
CyneRgy::PlotExampleFlowchart(
    lIntPoints = list(
        "Response" = c(
            "Load arm-specific probabilities of resistance",
            "Loop through patients",
            "Simulate resistance status (Binomial)",
            "If not resistant, simulate response (Binomial)",
            "Return response vector"
        )
    )
)
```
